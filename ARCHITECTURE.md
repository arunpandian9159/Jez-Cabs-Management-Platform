# Jez Cabs Management Platform - Architecture Documentation

## ğŸ—ï¸ System Architecture Overview

The Jez Cabs Management Platform is built using a **Modular Monolith Architecture** that provides the benefits of microservices (modularity, separation of concerns) while maintaining the simplicity of a monolithic deployment.

### Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Web Browser     â”‚  â”‚  Mobile App      â”‚  â”‚  Third-party     â”‚  â”‚
â”‚  â”‚  (React SPA)     â”‚  â”‚  (Future)        â”‚  â”‚  Integrations    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTPS/REST
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API GATEWAY LAYER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  NestJS Application (Port 3000)                               â”‚  â”‚
â”‚  â”‚  - CORS Configuration                                         â”‚  â”‚
â”‚  â”‚  - Global Validation Pipes                                    â”‚  â”‚
â”‚  â”‚  - JWT Authentication Guard                                   â”‚  â”‚
â”‚  â”‚  - Role-Based Access Control                                  â”‚  â”‚
â”‚  â”‚  - Swagger/OpenAPI Documentation                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APPLICATION LAYER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ IAM Module   â”‚  â”‚ Cab Module   â”‚  â”‚ Driver       â”‚              â”‚
â”‚  â”‚ âœ… Complete  â”‚  â”‚ â³ Pending   â”‚  â”‚ Module       â”‚              â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ â³ Pending   â”‚              â”‚
â”‚  â”‚ - Auth       â”‚  â”‚ - CRUD       â”‚  â”‚              â”‚              â”‚
â”‚  â”‚ - Users      â”‚  â”‚ - Status     â”‚  â”‚ - CRUD       â”‚              â”‚
â”‚  â”‚ - Companies  â”‚  â”‚ - Alerts     â”‚  â”‚ - License    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Booking      â”‚  â”‚ Checklist    â”‚  â”‚ Invoice      â”‚              â”‚
â”‚  â”‚ Module       â”‚  â”‚ Module       â”‚  â”‚ Module       â”‚              â”‚
â”‚  â”‚ â³ Pending   â”‚  â”‚ â³ Pending   â”‚  â”‚ â³ Pending   â”‚              â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
â”‚  â”‚ - Lifecycle  â”‚  â”‚ - Templates  â”‚  â”‚ - PDF Gen    â”‚              â”‚
â”‚  â”‚ - Conflicts  â”‚  â”‚ - Approval   â”‚  â”‚ - Payments   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Telematics   â”‚  â”‚ Analytics    â”‚  â”‚ Notification â”‚              â”‚
â”‚  â”‚ Module       â”‚  â”‚ Module       â”‚  â”‚ Module       â”‚              â”‚
â”‚  â”‚ â³ Pending   â”‚  â”‚ â³ Pending   â”‚  â”‚ â³ Pending   â”‚              â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
â”‚  â”‚ - GPS Track  â”‚  â”‚ - KPIs       â”‚  â”‚ - Email      â”‚              â”‚
â”‚  â”‚ - Geofence   â”‚  â”‚ - Reports    â”‚  â”‚ - Events     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA ACCESS LAYER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  TypeORM (PostgreSQL)        â”‚  â”‚  Mongoose (MongoDB)          â”‚ â”‚
â”‚  â”‚  - Entities                  â”‚  â”‚  - Schemas                   â”‚ â”‚
â”‚  â”‚  - Repositories              â”‚  â”‚  - Models                    â”‚ â”‚
â”‚  â”‚  - Migrations                â”‚  â”‚  - Aggregations              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      INFRASTRUCTURE LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ PostgreSQL   â”‚  â”‚ MongoDB      â”‚  â”‚ Redis        â”‚              â”‚
â”‚  â”‚ Port: 5432   â”‚  â”‚ Port: 27017  â”‚  â”‚ Port: 6379   â”‚              â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
â”‚  â”‚ - Companies  â”‚  â”‚ - Checklists â”‚  â”‚ - Sessions   â”‚              â”‚
â”‚  â”‚ - Users      â”‚  â”‚ - Telematics â”‚  â”‚ - Cache      â”‚              â”‚
â”‚  â”‚ - Cabs       â”‚  â”‚ - Logs       â”‚  â”‚              â”‚              â”‚
â”‚  â”‚ - Drivers    â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
â”‚  â”‚ - Bookings   â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
â”‚  â”‚ - Invoices   â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚ RabbitMQ     â”‚                                                   â”‚
â”‚  â”‚ Port: 5672   â”‚                                                   â”‚
â”‚  â”‚ Mgmt: 15672  â”‚                                                   â”‚
â”‚  â”‚              â”‚                                                   â”‚
â”‚  â”‚ - Events     â”‚                                                   â”‚
â”‚  â”‚ - Queues     â”‚                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow

### 1. Authentication Flow

```
User â†’ POST /api/auth/register
  â†“
API Gateway (Validation)
  â†“
IAM Module â†’ AuthService
  â†“
Check if company/user exists
  â†“
Hash password (bcrypt)
  â†“
Create Company (PostgreSQL)
  â†“
Create User (PostgreSQL)
  â†“
Generate JWT Token
  â†“
Return Token + User Data
```

### 2. Protected Resource Access Flow

```
User â†’ GET /api/cabs (with JWT token)
  â†“
API Gateway
  â†“
JwtAuthGuard â†’ Validate Token
  â†“
Extract User from Token
  â†“
RolesGuard â†’ Check User Role
  â†“
Cab Module â†’ CabService
  â†“
Filter by companyId (Multi-tenant)
  â†“
Query PostgreSQL
  â†“
Return Cabs
```

### 3. Event-Driven Flow (Future)

```
Booking Created
  â†“
EventEmitter â†’ booking.created
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚                 â”‚                 â”‚
Cab Module        Invoice Module    Notification Module
Update Status     Generate Invoice  Send Email
```

---

## ğŸ—„ï¸ Database Design

### PostgreSQL Schema (Relational Data)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   companies     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚
â”‚ name            â”‚
â”‚ contactEmail    â”‚
â”‚ contactPhone    â”‚
â”‚ subscriptionTierâ”‚
â”‚ isActive        â”‚
â”‚ createdAt       â”‚
â”‚ updatedAt       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 1:N
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚       â”‚      cabs       â”‚       â”‚    drivers      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚       â”‚ id (PK)         â”‚       â”‚ id (PK)         â”‚
â”‚ companyId (FK)  â”‚       â”‚ companyId (FK)  â”‚       â”‚ companyId (FK)  â”‚
â”‚ email           â”‚       â”‚ make            â”‚       â”‚ firstName       â”‚
â”‚ passwordHash    â”‚       â”‚ model           â”‚       â”‚ lastName        â”‚
â”‚ role            â”‚       â”‚ registrationNo  â”‚       â”‚ licenseNumber   â”‚
â”‚ firstName       â”‚       â”‚ status          â”‚       â”‚ licenseExpiry   â”‚
â”‚ lastName        â”‚       â”‚ insuranceExpiry â”‚       â”‚ contactNumber   â”‚
â”‚ isActive        â”‚       â”‚ gpsDeviceId     â”‚       â”‚ isActive        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚                          â”‚
                                  â”‚                          â”‚
                                  â–¼                          â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    bookings     â”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚ id (PK)         â”‚
                          â”‚ companyId (FK)  â”‚
                          â”‚ cabId (FK)      â”‚
                          â”‚ driverId (FK)   â”‚
                          â”‚ clientName      â”‚
                          â”‚ startDate       â”‚
                          â”‚ endDate         â”‚
                          â”‚ status          â”‚
                          â”‚ totalAmount     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ 1:1
                                  â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    invoices     â”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚ id (PK)         â”‚
                          â”‚ companyId (FK)  â”‚
                          â”‚ bookingId (FK)  â”‚
                          â”‚ invoiceNumber   â”‚
                          â”‚ amount          â”‚
                          â”‚ taxAmount       â”‚
                          â”‚ status          â”‚
                          â”‚ pdfUrl          â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MongoDB Schema (Flexible Data)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         checklists                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id                                 â”‚
â”‚ companyId                           â”‚
â”‚ bookingId                           â”‚
â”‚ cabId                               â”‚
â”‚ templateName                        â”‚
â”‚ items: [                            â”‚
â”‚   {                                 â”‚
â”‚     itemName: string                â”‚
â”‚     status: PASS|FAIL|NA            â”‚
â”‚     notes: string                   â”‚
â”‚     images: [string]                â”‚
â”‚   }                                 â”‚
â”‚ ]                                   â”‚
â”‚ completedBy                         â”‚
â”‚ completedAt                         â”‚
â”‚ approvedBy                          â”‚
â”‚ approvedAt                          â”‚
â”‚ isComplete                          â”‚
â”‚ isApproved                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       telematics_logs               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id                                 â”‚
â”‚ companyId                           â”‚
â”‚ cabId                               â”‚
â”‚ gpsDeviceId                         â”‚
â”‚ timestamp                           â”‚
â”‚ location: {                         â”‚
â”‚   latitude: number                  â”‚
â”‚   longitude: number                 â”‚
â”‚ }                                   â”‚
â”‚ speed                               â”‚
â”‚ heading                             â”‚
â”‚ eventType                           â”‚
â”‚ metadata                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Architecture

### Authentication & Authorization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layers                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. HTTPS/TLS (Transport Layer Security)                   â”‚
â”‚     â””â”€ All communication encrypted                         â”‚
â”‚                                                             â”‚
â”‚  2. CORS (Cross-Origin Resource Sharing)                   â”‚
â”‚     â””â”€ Whitelist allowed origins                           â”‚
â”‚                                                             â”‚
â”‚  3. Input Validation                                        â”‚
â”‚     â””â”€ class-validator on all DTOs                         â”‚
â”‚                                                             â”‚
â”‚  4. JWT Authentication                                      â”‚
â”‚     â”œâ”€ Token-based stateless auth                          â”‚
â”‚     â”œâ”€ 7-day expiration                                    â”‚
â”‚     â””â”€ Bearer token in Authorization header                â”‚
â”‚                                                             â”‚
â”‚  5. Role-Based Access Control (RBAC)                       â”‚
â”‚     â”œâ”€ OWNER: Full access                                  â”‚
â”‚     â”œâ”€ MANAGER: Limited admin access                       â”‚
â”‚     â””â”€ STAFF: Read-only + assigned tasks                   â”‚
â”‚                                                             â”‚
â”‚  6. Multi-Tenant Data Isolation                            â”‚
â”‚     â””â”€ All queries filtered by companyId                   â”‚
â”‚                                                             â”‚
â”‚  7. Password Security                                       â”‚
â”‚     â”œâ”€ bcrypt hashing (12 rounds)                          â”‚
â”‚     â”œâ”€ Complexity requirements                             â”‚
â”‚     â””â”€ Never stored in plain text                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Multi-Tenancy Strategy

```
Request with JWT Token
  â†“
Extract companyId from token
  â†“
All database queries automatically filtered:
  WHERE companyId = :companyId
  â†“
User can ONLY access their company's data
```

---

## ğŸ“¦ Module Structure

Each module follows this structure:

```
module-name/
â”œâ”€â”€ dto/                    # Data Transfer Objects
â”‚   â”œâ”€â”€ create-*.dto.ts
â”‚   â”œâ”€â”€ update-*.dto.ts
â”‚   â””â”€â”€ filter-*.dto.ts
â”œâ”€â”€ entities/               # Database Entities (PostgreSQL)
â”‚   â””â”€â”€ *.entity.ts
â”œâ”€â”€ schemas/                # MongoDB Schemas
â”‚   â””â”€â”€ *.schema.ts
â”œâ”€â”€ services/               # Business Logic
â”‚   â””â”€â”€ *.service.ts
â”œâ”€â”€ controllers/            # HTTP Controllers
â”‚   â””â”€â”€ *.controller.ts
â”œâ”€â”€ guards/                 # Authorization Guards
â”‚   â””â”€â”€ *.guard.ts
â”œâ”€â”€ events/                 # Event Handlers
â”‚   â””â”€â”€ *.event.ts
â””â”€â”€ module-name.module.ts   # Module Definition
```

---

## ğŸ”„ Event-Driven Architecture

### Event Flow (Planned)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Event Emitter                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  booking.created                                            â”‚
â”‚    â”œâ”€â†’ Update cab status to RENTED                         â”‚
â”‚    â”œâ”€â†’ Send booking confirmation email                     â”‚
â”‚    â””â”€â†’ Create initial checklist                            â”‚
â”‚                                                             â”‚
â”‚  booking.completed                                          â”‚
â”‚    â”œâ”€â†’ Generate invoice                                    â”‚
â”‚    â”œâ”€â†’ Require checklist completion                        â”‚
â”‚    â””â”€â†’ Send invoice email                                  â”‚
â”‚                                                             â”‚
â”‚  checklist.approved                                         â”‚
â”‚    â”œâ”€â†’ Update cab status to AVAILABLE                      â”‚
â”‚    â””â”€â†’ Notify fleet manager                                â”‚
â”‚                                                             â”‚
â”‚  document.expiring                                          â”‚
â”‚    â”œâ”€â†’ Send alert email (30 days before)                   â”‚
â”‚    â””â”€â†’ Create notification                                 â”‚
â”‚                                                             â”‚
â”‚  telematics.alert                                           â”‚
â”‚    â”œâ”€â†’ Log event                                           â”‚
â”‚    â”œâ”€â†’ Send real-time notification                         â”‚
â”‚    â””â”€â†’ Update driver score                                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Architecture (Future)

### Production Deployment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Load Balancer (Nginx)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NestJS App 1 â”‚  â”‚ NestJS App 2 â”‚  â”‚ NestJS App 3 â”‚
â”‚ (Container)  â”‚  â”‚ (Container)  â”‚  â”‚ (Container)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     Database Cluster                â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚PostgreSQLâ”‚      â”‚ MongoDB  â”‚    â”‚
        â”‚  â”‚ Primary  â”‚      â”‚ Replica  â”‚    â”‚
        â”‚  â”‚ + Replicaâ”‚      â”‚ Set      â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Performance Considerations

### Caching Strategy

```
Request â†’ Check Redis Cache
            â”‚
            â”œâ”€ Cache Hit â†’ Return Cached Data
            â”‚
            â””â”€ Cache Miss â†’ Query Database
                            â”‚
                            â””â”€ Store in Redis â†’ Return Data
```

### Database Indexing

```sql
-- PostgreSQL Indexes
CREATE INDEX idx_users_company ON users(companyId);
CREATE INDEX idx_cabs_company_status ON cabs(companyId, status);
CREATE INDEX idx_bookings_company_dates ON bookings(companyId, startDate, endDate);
CREATE INDEX idx_invoices_company_status ON invoices(companyId, status);
```

```javascript
// MongoDB Indexes
db.checklists.createIndex({ companyId: 1, bookingId: 1 });
db.telematics_logs.createIndex({ companyId: 1, cabId: 1, timestamp: -1 });
```

---

## ğŸ”§ Technology Stack Details

### Backend Framework
- **NestJS 10.x**: Enterprise-grade Node.js framework
- **TypeScript 5.x**: Type-safe development
- **Node.js 18+**: Runtime environment

### Databases
- **PostgreSQL 15**: Relational data with ACID compliance
- **MongoDB 7**: Flexible schema for logs and checklists

### Authentication
- **Passport.js**: Authentication middleware
- **JWT**: Stateless token-based auth
- **bcrypt**: Password hashing

### API Documentation
- **Swagger/OpenAPI**: Auto-generated interactive docs

### Validation
- **class-validator**: DTO validation
- **class-transformer**: Object transformation

### ORM/ODM
- **TypeORM**: PostgreSQL ORM
- **Mongoose**: MongoDB ODM

### Messaging (Future)
- **RabbitMQ**: Message broker for async communication

### Caching (Future)
- **Redis**: In-memory data store

---

**Last Updated:** 2025-10-09

